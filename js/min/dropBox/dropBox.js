(function(A,B){var C=function(D,E){this.opts={options:{type:"auto",dropDom:null,data:[],trigger:"mousedown",ajax:"",ajaxType:"post",stag:"a",icon:null,iconClass:""},classNames:{box:"dropBox_box",list:"dropBox_list",hover:"dropBox_hover",checked:"",blur:""},template:{showBox:'<ul ${classname} style="display:none;">${inner}</ul>',showInner:"<li ${flag}>${txt}</li>"},listeners:{returnVal:function(F,G){return F;}}};this.target=A(D);this.init();this.initialize(E);};C.prototype={init:function(){var D=document.createElement("div");D.id="_dropBoxTemp_";D.style.display="none";$$.container.append(D);this.tempBox=A("#_dropBoxTemp_");},initialize:function(D){this.setOptions(D);this.bindEvent();},setOptions:function(D){A.extend(true,this.opts,D);this.sView=null;this.saveData={};this._privateNowHover=null;this._xy=null;var E=this;({"auto":function(){E.creatHtml(E.opts.options.data);},"select":function(){E.creatHtml(E.opts.options.data.length>0?E.opts.options.data:E.target.data("select-data").split(","));E.target[0].setAttribute("readOnly","readonly");},"drop":function(){E.sView=E.opts.options.dropDom||A("#"+E.target.data("drop-dom"));}}[E.opts.options.type]());},iconShow:function(){if(this.opts.options.icon){for(var D in this.opts.options.icon){this.opts.options.icon[D].addClass(this.opts.options.iconClass);}}},iconHide:function(){if(this.opts.options.icon){for(var D in this.opts.options.icon){this.opts.options.icon[D].removeClass(this.opts.options.iconClass);}}},bindEvent:function(){var E=this.sView,F=this,H=false,D=false,J,G,I;this.target.bind(F.opts.options.trigger,function(K){var L;if(F.opts.options.type=="auto"){L=F.target[0].value.replace(/\s*/g,"");}if(F.opts.options.type!="drop"){F.resizeXy();}if(F.opts.options.type!="auto"){E.show();H=true;F.iconShow();}F.target.addClass(F.opts.classNames.checked);if(!F.sView.html()){E.hide();}else{if(J==L&&L){E.show();}}});this.target.bind("blur",function(){clearTimeout(G);if(F._privateNowHover){F._privateNowHover.removeClass(F.opts.classNames.hover);}E.hide();F.target.removeClass(F.opts.classNames.checked);F.target.addClass(F.opts.classNames.blur);F.iconHide();});E.bind("mousedown",function(K){K=K||window.event;var L=K.target||K.srcElement;D=true;setTimeout(function(){D=false;},1);if(L.getAttribute("data-tag")||(L.tagName==F.opts.options.stag.toLocaleUpperCase())){F.target.val(L.innerHTML);I=L.innerHTML;F.opts.listeners.returnVal(L.innerHTML,L);F.target.trigger("blur");}else{K.preventDefault?K.preventDefault():(K.returnValue=false);if(K.stopPropagation){K.stopPropagation();}return false;}});if($$.browser.isIE){this.target[0].onbeforedeactivate=function(){if(D){return D=false;}return true;};}if(F.opts.options.type!="drop"){this.target.bind("keyup",function(K){K=K||window.event;var M=K.keyCode,L=F.target[0].value.replace(/\s*/g,"");if(I==L||!L){E.css("display","none");return;}switch(M){case A.KEY_DOWN:F.hoverList(1);break;case A.KEY_UP:F.hoverList(0);break;case A.KEY_ENTER:clearTimeout(timer);F.fillInput();J=F.target[0].value.replace(/\s*/g,"");break;default:if(F.opts.options.type=="auto"){timer=setTimeout(function(){F.sendAjax(L,F.opts.options.ajax||F.target.data("ajax-url"));},100);}break;}});}else{A(document).bind("click",function(K){if(H){var L=K.target||K.srcElement;if(!A.contains(E[0],L)&&!A.contains(F.target[0],L)&&(L!=E[0]&&L!=F.target[0])){F.target.removeClass(F.opts.classNames.checked);F.target.addClass(F.opts.classNames.blur);E.hide();F.iconHide();H=false;}}});}},creatHtml:function(E){var F=A.template.render(this.opts.template.showBox,{classname:"class = "+this.opts.classNames.box,inner:this.opts.options.type=="auto"?"":this.creatList(E)});this.tempBox.html(F);var D=this.tempBox.children().first();D[0].id=this.target[0].id+"_s";D[0].style.position="absolute";this.sView=A("#"+D[0].id);$$.container.append(D);},creatList:function(E){var H="";for(var F=0,D=E.length;F<D;F++){var G=E[F].split("|");H+=A.template.render(this.opts.template.showInner,{flag:"data-tag="+G[0],txt:G[1]});}return H;},replaceHtml:function(E){var F=E.length;if(F<1||(F==1&&!E[0])){this.sView.css("display","none");}else{var D=this.sView;D.html("");D.html(this.creatList(E));D.show();}},resizeXy:function(){this._xy=this.target.offset();this.sView.css("left",parseInt(this._xy.left)+"px");this.sView.css("top",parseInt(this._xy.top+this.target[0].offsetHeight)+"px");},fillInput:function(){if(this._privateNowHover!=null){if(!this._privateNowHover[0].getAttribute("data-tag")){this.target.value(this._privateNowHover.find(this.opts.options.stag)[0].innerHTML);}else{this.target.value(this._privateNowHover[0].innerHTML);}this._privateNowHover.removeClass(this.opts.classNames.hover);}this.sView.hide();},hoverList:function(F){var H=this,D=null;if(F==0){if(H._privateNowHover==null){D=H.sView.find("li").filter(":last");}else{var E=H._privateNowHover.previousSibling();D=E.length>0?E:H.sView.find("li").filter(":last");H._privateNowHover.removeClass(H.opts.classNames.hover);}}else{if(F==1){if(H._privateNowHover==null){D=H.sView.find("li").filter(":first");}else{var G=H._privateNowHover.nextSibling();D=G.length>0?G:H.sView.find("li").filter(":first");H._privateNowHover.removeClass(H.opts.classNames.hover);}}}D.addClass(H.opts.classNames.hover);H._privateNowHover=D;},sendAjax:function(F,D){if(!F){return;}var G=this,E={method:this.opts.options.ajaxType,context:{key:F},cache:true,success:function(H,I){var J=I.split("@");G.replaceHtml(J);}};A.ajax(D,E);}};A.fn.extend({DropBox:function(D){var E={};if(typeof D!=="undefined"){A.extend(true,E,D);}C["instance"]=new C(this,E);return C["instance"];}});})(jQuery,undefined);