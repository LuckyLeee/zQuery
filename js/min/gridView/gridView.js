(function(A){var D=function(H){var K=H.split("."),J=K[0],N=K.length>1?"."+K[1]:"",O=J.length,I="",M=Math.floor(O/3);for(var P=0;P<M;P++){var L=J.slice(O-3,O);J=J.substr(0,O-3);I=(","+L)+I;O=J.length;}J+=I+N;return J.length>0&&J.substr(0,1)===","?J.substr(1,J.length):J;};String.prototype.Thousand=function(H){return D(parseFloat(this).toFixed(H===undefined?2:H));};Number.prototype.Thousand=function(H){return D(this.toFixed(H===undefined?2:H));};var B=[];A(window).on("resize.gridView",function(){for(var H=0,I=B.length;H<I;H++){B[H].css("width",B[H].parent().width());}});var E=function(H,I){I=A.extend({type:true,bindDataSource:[],panel:null,btn:null,icon:null,view:null,btns:null,btnOk:null,btnChecks:null,btnAll:null,checkAll:null,checkAllBtn:null,selectData:[],onChange:null},I);A.extend(this,I);this.panel=A(H);this.init();};E.prototype={init:function(){this.setOptions();this.bindEvent();},setOptions:function(){this.btn=this.panel.children("b");this.icon=this.btn.children("i");this.view=this.panel.children("ul");this.initView();if(this.type){this.btnAll=this.view.find("li:eq(0)>a");this.btns=this.view.find("li:gt(0)>a");}else{this.checkAll=this.view.find("li:eq(0)>label");this.checkAllBtn=this.checkAll.children("input");this.btnChecks=this.view.find("li:gt(0) input");this.btnOk=this.view.find("li.btn>a");}},bindEvent:function(){var H=this;this.btn.on("click.grid_where",function(){if(H.btn.data("__type__")){H.hide();}else{H.show();}});if(this.type){this.btnAll.on("click.grid_where",function(){H.selectData=[];H.hide();H.change();});this.btns.on("click.grid_where",function(){H.selectData=[];H.selectData.push(A(this).data("value"));H.hide();H.change();});}else{this.checkAll.on("click.grid_where",function(){H.setAll();});this.btnOk.on("click.grid_where",function(){H.hide();H.change();});}},initView:function(){$$.container.append(this.view);},show:function(){this.view.css({position:"absolute",left:this.btn.offset().left,top:this.btn.offset().top+this.btn.height()+1});this.btn.data("__type__",true);this.panel.cover();this.panel.addClass("active");this.icon.removeClass("icon-caret-down").addClass("icon-caret-up");this.view.show();var H=this;A(document).on("click.grid_where",function(I){var J=A(I.target);if(!H.hasParent(J[0],[H.view[0],H.btn[0]])){H.hide();}});},hide:function(){A(document).off("click.grid_where");this.btn.data("__type__",false);this.panel.uncover();this.panel.removeClass("active");this.icon.removeClass("icon-caret-up").addClass("icon-caret-down");this.view.hide();},change:function(H){A.type(this.onChange)==="function"&&this.onChange.call(null);},setAll:function(){var H=this;A.each(this.btnChecks,function(){this.checked=H.checkAllBtn[0].checked;});},getData:function(){if(this.type){return this.selectData;}else{var H=this;this.selectData=[];A.each(this.btnChecks,function(){if(this.checked){H.selectData.push(A(this).data("value"));}});return this.selectData;}},hasParent:function(J,I){var L=J,H=false;if(L!=null){for(var K=0,M=I.length;K<M;K++){if(I[K]==L){return true;}}while(L.parentNode!=null){L=L.parentNode;for(var K=0,M=I.length;K<M;K++){if(I[K]==L){return true;}}}}return H;}};var F=function(H,I){I=A.extend({index:1,viewNum:3,pageNum:50,total:100,pageRate:[50,100,200,500],onChange:null,onSetNum:null,type:true},I);A.extend(this,I);this.target=A(H);this.init(I);};F.prototype={init:function(){this.setOptions();if(this.type){this.viewPage(this.index);}else{this.viewPageNumber(this.index);}},setOptions:function(){this.pageTotal=this.total%this.pageNum>0?parseInt(this.total/this.pageNum)+1:parseInt(this.total/this.pageNum);},prevPage:function(){this.index-=1;return this.setPageByIndex(this.index);},nextPage:function(){this.index+=1;return this.setPageByIndex(this.index);},setTotle:function(H){this.total=H;this.pageTotal=this.total%this.pageNum>0?parseInt(this.total/this.pageNum)+1:parseInt(this.total/this.pageNum);if(this.type){this.viewPage(this.index);}else{this.viewPageNumber(this.index);}},bindEvent:function(){var H=this;this.target.off("click.gridPage");this.target.on("click.gridPage",function(I){I=I||window.event;var J=I.target||I.srcElement;J=J.tagName==="I"?J.parentNode:J;if(J.tagName==="A"){if(A(J).hasClass("no")){return;}var K=A(J).data("type"),L={"prev":function(){H.prevPage();},"next":function(){H.nextPage();},"first":function(){H.setPageByIndex(1);},"last":function(){H.setPageByIndex(H.pageTotal);},"refresh":function(){H.setPageByIndex(H.index);}};if(L[K]){L[K]();}else{var M=parseInt(J.innerHTML,10);H.setPageByIndex(M);}}});this.pageInput.on("keydown.gridPage",function(I){if(I.keyCode==A.KEY_ENTER){var J=H.pageInput.val();J=J.replace(/\D/g,"");if(J.length==0){H.setPageByIndex(1);}else{if(~~J==H.index){H.pageInput.val(H.index);return;}if(~~J>H.pageTotal){H.setPageByIndex(H.pageTotal);}else{H.setPageByIndex(J);}}}});this.numDrop&&this.numDrop.on("change.gridPage",function(){H.pageNum=~~H.numDrop.val();if(A.type(H.onSetNum)==="function"){H.index=1;H.setTotle(H.total);H.onSetNum.call(this,H.numDrop.val());}});},setPageByIndex:function(H){if(typeof H==="undefined"){return this.index;}else{this.index=H=~~H;if(A.type(H)==="number"){if(H<1){return[false,"over-low"];}else{if(H>this.pageTotal){return[false,"over-high"];}else{this.indexHtml&&this.indexHtml.html(H);if(this.type){this.pageInput.val(H);this.initPage();}else{this.viewPageNumber(H);this.pageInput.val(H);}if(A.type(this.onChange)==="function"){this.onChange.call(null,H);}return[true,""];}}}}},initPage:function(){if(this.index==1){this.firstBtn&&this.firstBtn.addClass("no");this.prevBtn.addClass("no");}else{this.firstBtn&&this.firstBtn.removeClass("no");this.prevBtn.removeClass("no");}if(this.index<this.pageTotal){this.nextBtn.removeClass("no");this.lastBtn&&this.lastBtn.removeClass("no");}else{this.nextBtn.addClass("no");this.lastBtn&&this.lastBtn.addClass("no");}},viewPageNumber:function(N){this.index=N;var K=this.viewNum%2,M=(this.viewNum-K)/2,L=N-(N-K)%M,J=Math.max(1,L-M+1-K),H=Math.min(this.pageTotal,J+this.viewNum-1);var I='<div class="page_box">                <$ var start = GlobalData.start,end = GlobalData.end,currentIndex = GlobalData.currentIndex; $>                <div class="page">                    <span class="text">共 <$= GlobalData.total $> 条</span>                    <a href="javascript:" class="prev" data-type="prev">&lt;</a>                    <$ if(start > 1){ $>                        <a href="javascript:" class="num">1</a>                    <$ } $>                    <$ if(start > 2){ $>                        <span class="more">...</span>                    <$ } $>                    <$ for(;start < currentIndex;start++){ $>                        <a href="javascript:" class="num"><$= start $></a>                    <$ } $>                    <span class="num active"><$= GlobalData.currentIndex $></span>                    <$ for (currentIndex++; currentIndex <= end; currentIndex++) { $>                        <a href="javascript:" class="num"><$= currentIndex $></a>                    <$ } $>                    <$ if(end < GlobalData.pageTotal - 1){ $>                        <span class="more">...</span>                    <$ } $>                    <$ if(end < GlobalData.pageTotal){ $>                        <a href="javascript:" class="num"><$= GlobalData.pageTotal $></a>                    <$ } $>                    <a href="javascript:" class="next" data-type="next">&gt;</a>                    <span class="text"><input type="text"></span>                    <span class="button"><input type="button" value="Go"></span>                </div>            </div>';this.target.html(A.template.replace(I,{total:this.total,currentIndex:N,start:J,end:H,pageTotal:this.pageTotal}));this.prevBtn=this.target.find(".prev");this.nextBtn=this.target.find(".next");this.pageInput=this.target.find("input:eq(0)");this.initPage();this.bindEvent();},viewPage:function(I){this.index=I;var H='                    <div class="pGroup"><select>                        <$ for(var i = 0,l = GlobalData.pageRate.length;i < l;i++){ $>                            <option value="<$= GlobalData.pageRate[i] $>"><$= GlobalData.pageRate[i] $>&nbsp;&nbsp;</option>                        <$ } $>                    </select></div>                    <div class="btnseparator"></div>                    <div class="pageNum">                        <div class="pGroup">                            <a href="javascript:" class="first" data-type="first" title="第一页"><i class="icon-step-backward"></i></a>                            <a href="javascript:" class="prev" data-type="prev" title="上一页"><i class="icon-caret-left"></i></a>                        </div>                        <div class="btnseparator"></div>                        <div class="pGroup">                            到<input type="text" value="<$= GlobalData.index $>" />页                        </div>                        <div class="btnseparator"></div>                        <div class="pGroup">                            <a href="javascript:" class="next" data-type="next" title="下一页"><i class="icon-caret-right"></i></a>                            <a href="javascript:" class="last" data-type="last" title="最后一页"><i class="icon-step-forward"></i></a>                        </div>                        <div class="btnseparator"></div>                        <div class="pGroup">                            <a href="javascript:" class="refresh" data-type="refresh" title="刷新"><i class="icon-refresh"></i></a>                        </div>                    </div>                    <div class="btnseparator"></div>                    <div class="pGroup"><span>共<$= GlobalData.pageTotal $>页</span></div>                    <div class="pGroup"><span><$= GlobalData.index $></span><span>/<$= GlobalData.pageTotal $></span></div>';this.target.html(A.template.replace(H,{pageRate:this.pageRate,index:this.index,total:this.total,pageTotal:this.pageTotal}));this.indexHtml=this.target.find("span:eq(1)");this.numDrop=this.target.find("select");this.numDrop.val(this.pageNum);this.firstBtn=this.target.find(".first");this.prevBtn=this.target.find(".prev");this.nextBtn=this.target.find(".next");this.lastBtn=this.target.find(".last");this.pageInput=this.target.find("input");this.initPage();this.bindEvent();}};A.fn.extend({GridPage:function(H){var I={};if(typeof H!=="undefined"){A.extend(true,I,H);}F["instance"]=new F(this,I);return F["instance"];},GridWhere:function(H){var I={};if(typeof H!=="undefined"){A.extend(true,I,H);}return new E(this,I);}});var G={};G.ColHeadControl=A.Base.Event.extend({init:function(H){A.extend(this,{panel:null,colList:[],prevSort:null,headTempalte:'                    <tr>                        <$ for(var i = 0,l = GlobalData.colHead.length;i < l;i++){                            var item = GlobalData.colHead[i]; $>                            <th colspan="<$= item.colspan $>">                                <div style="text-align: center;"><$= item.title $></div>                            </th>                        <$ } $>                    </tr>',template:'                <div class="colHeadBox">                    <table cellpadding="0" cellspacing="0">                        <$= GlobalData.headHtml $>                        <tr>                        <$ if(GlobalData.isLeftTemplate && GlobalData.isTemplate){ $>                            <th class="grid_template" data-col="grid_template" align="center">                                <div style="text-align:center;width:<$= GlobalData.templateWidth - 10 $>px;">操作</div>                            </th>                        <$ } $>                        <$ if(GlobalData.isNumber){ $>                            <th data-col="grid_number" align="center">                                <div style="text-align: center;width:30px;"></div>                            </th>                        <$ } $>                        <$ if(GlobalData.isCheckBox){ $>                            <th data-col="grid_check" align="center">                                <div style="text-align: center;width:40px;">                                    <label><input type="checkbox" />全选</label>                                </div>                            </th>                        <$ } $>                        <$ for(var i = 0,l = GlobalData.colModule.length;i < l;i++){                            var item = GlobalData.colModule[i];$>                            <th data-col="<$= item.name $>" class="<$= item.className $>">                                <div style="text-align:<$= item.headAlign $>;width:<$= item.width $>px">                                <$ if(item.where){ $>                                    <span class="shelves">                                        <b style="width:<$= item.width $>px"><$= item.title $><i class="icon-caret-down"></i></b>                                        <ul class="shelves_info" style="display:none;width:<$= item.width + 20 $>px">                                        <$ if(item.where.type){ $>                                            <li><a href="javascript:">全部</a></li>                                            <$ for(var j = 0,jl = item.where.bindDataSource.length;j < jl;j++){                                                var whereItem = item.where.bindDataSource[j]; $>                                                <li><a href="javascript:" data-value="<$= whereItem.value $>"><$= whereItem.key $></a></li>                                            <$ } $>                                        <$ }else{ $>                                            <li><label><input type="checkbox" />全部</label></li>                                            <$ for(var j = 0,jl = item.where.bindDataSource.length;j < jl;j++){                                                var whereItem = item.where.bindDataSource[j]; $>                                                <li><label><input type="checkbox" data-value="<$= whereItem.value $>" /><$= whereItem.key $></label></li>                                            <$ } $>                                            <li class="btn"><a href="javascript:" class="orangebtn">确认</a></li>                                        <$ } $>                                        </ul>                                    </span>                                <$ }else{ $>                                    <$= item.title $><i></i>                                <$ } $>                                </div>                            </th>                        <$ } $>                        <$ if(!GlobalData.isLeftTemplate && GlobalData.isTemplate){ $>                            <th class="grid_template" data-col="grid_template" align="center">                                <div style="text-align:center;width:<$= GlobalData.templateWidth - 10 $>px;">操作</div>                            </th>                        <$ } $>                        </tr>                    </table>                </div>'},H);this.setOptions();this.bindEvent();},setOptions:function(){var H=null;if(this.colHead.length>0){this.initColHead();H=A.template.replace(this.headTempalte,{colHead:this.colHeadList});}this.panel.html(A.template.replace(this.template,{colModule:this.colModule,templateWidth:this.templateWidth,isTemplate:this.isTemplate,isLeftTemplate:this.isLeftTemplate,isCheckBox:this.isCheckBox,isNumber:this.isNumber,headHtml:H==null?"":H}));this.colPanel=this.panel.find("tr:eq("+(this.colHead.length>0?1:0)+")");if(this.isCheckBox){this.checkAll=this.colPanel.find("th:eq("+((false==this.isNumber?0:1)+(false==this.isLeftTemplate?0:1))+") label");this.checkBtn=this.checkAll.children("input");this.newEvent("checkAll","memory");}this.initColList();this.newEvent("sortChange","memory");this.newEvent("whereChange","memory");},bindEvent:function(){var H=this;if(this.isCheckBox){this.checkAll.on("click.gridView",function(){H.triggerEvent("checkAll",H.checkBtn[0].checked);});}},initColHead:function(){var H=[];this.isNumber&&H.push({title:""});this.isCheckBox&&H.push({title:""});for(var I=0,J=this.colHead.length;I<J;I++){H.push({title:this.colHead[I].title,colspan:this.colHead[I].colspan});}this.isTemplate&&H.push({title:""});this.colHeadList=H;},initColList:function(){var J=this;for(var I=0,K=this.colModule.length;I<K;I++){var H=new G.ColControl({panel:this.colPanel.find("th:eq("+(I+this.otherColNumber)+")"),name:this.colModule[I].name,isSort:this.isSort&&this.colModule[I].isSort,where:this.colModule[I].where});H.addEvent("whereChange",function(){J.triggerEvent("whereChange",J.getWhere());});H.addEvent("sortChange",function(){if(J.prevSort&&J.prevSort.name!=this.name){J.prevSort.removeSort();}J.prevSort=this;J.triggerEvent("sortChange",{sortName:this.name,sortOrder:this.sortOrder});});this.colList.push(H);}},setSort:function(I,H){},setColWidth:function(H){this.colList[H].panel.children("div").css("width",this.colModule[H].width+"px");},getWhere:function(){var I={};for(var J=0,K=this.colModule.length;J<K;J++){if(this.colModule[J].where){var H=this.colList[J].gridWhere.getData();if(H.length>0){I[this.colModule[J].name]=H;}}}return I;}});G.ColControl=A.Base.Event.extend({init:function(H){A.extend(this,{panel:null,name:null,gridWhere:null,where:null,isSort:false,sortBtn:null,sortOrder:null},H);this.setOptions();this.bindEvent();},setOptions:function(){var H=this;if(this.where){this.newEvent("whereChange","memory");this.gridWhere=this.panel.find("span.shelves").GridWhere({type:this.where.type,onChange:function(){H.triggerEvent("whereChange");}});}else{if(this.isSort){this.sortBtn=this.panel.find("i");if(this.sortOrder){this.sortBtn.addClass(this.sortOrder=="desc"?"icon-arrow-down":"icon-arrow-up");}this.newEvent("sortChange","memory");}}},bindEvent:function(){var H=this;if(this.where){}else{if(this.isSort){this.panel.hover(function(){H.hoverSortBtn(true);},function(){if(H.sortOrder){H.hoverSortBtn(false);}else{H.sortBtn.removeClass("icon-arrow-down").removeClass("icon-arrow-up");}});this.panel.on("click.gridView",function(){if(H.sortOrder){H.sortOrder=H.sortOrder=="desc"?"esc":"desc";H.hoverSortBtn(false);}else{H.sortOrder="desc";}H.triggerEvent("sortChange");});}}},hoverSortBtn:function(H){if(H){if(this.sortBtn.hasClass("icon-arrow-down")){this.sortBtn.removeClass("icon-arrow-down").addClass("icon-arrow-up");}else{this.sortBtn.removeClass("icon-arrow-up").addClass("icon-arrow-down");}}else{if(this.sortOrder=="desc"){this.sortBtn.removeClass("icon-arrow-up").addClass("icon-arrow-down");}else{this.sortBtn.removeClass("icon-arrow-down").addClass("icon-arrow-up");}}},removeSort:function(){this.sortOrder=null;this.sortBtn.removeClass("icon-arrow-down").removeClass("icon-arrow-up");}});G.DragControl=A.Base.Event.extend({init:function(H){A.extend(this,{panel:null,colModule:null,scrollLeft:0,template:'                    <$ for(var i = 0,l = GlobalData.dragList.length;i < l;i++){                        var left = GlobalData.dragList[i]; $>                        <div style="height:<$= GlobalData.height $>px;left:<$= left $>px;"></div>                    <$ } $>                '},H);this.setOptions();this.bindEvent();},setOptions:function(){this.loadPage();this.newEvent("dragCol","memory");},bindEvent:function(){var H=this;this.panel.children("div").each(function(J,K){var I=A(K);(function(M,N,L){var O=0,P=false;_moveNum=0;N.on("mousedown.gridView",function(Q){O=Q.clientX;N.addClass("over");P=true;L.on({"mousemove.gridView":function(R){if(P){var S=H.dragList[M]+R.clientX-O;if(S>H.dragList[M]-H.colModule[M].width+20){_moveNum=R.clientX-O;N.css("left",S+"px");}}},"mouseup.gridView":function(R){if(P){N.removeClass("over");P=false;H.colModule[M].width+=_moveNum;H.loadPage();H.bindEvent();H.triggerEvent("dragCol",{index:M,moveNumber:_moveNum});L.off("mousemove").off("mouseup");}}});});})(J,I,H.panel.parent());});},initDrag:function(){var K=[],J=0;if(this.isLeftTemplate){J+=this.templateWidth+10;}if(this.isNumber){J+=41;}if(this.isCheckBox){J+=51;}for(var I=0,H=this.colModule.length;I<H;I++){J+=this.colModule[I].width+11;K.push(J-2-this.scrollLeft);}this.dragList=K;},loadPage:function(){this.initDrag();this.panel.html(A.template.replace(this.template,{height:this.height,dragList:this.dragList}));},setScrollLeft:function(H){this.scrollLeft=H;this.loadPage();this.bindEvent();}});G.TableControl=A.Base.Event.extend({init:function(H){A.extend(this,{panel:null,rowList:[],colModule:null,data:null,height:null,selectRow:null,template:'                <table cellpadding="0" cellspacing="0" border="0" >                    <$ for(var i = 0,l = GlobalData.data.length;i < l;i++){                        var item = GlobalData.data[i],                            _trClass = (i + 1) % 2 == 0 ? "class=two" : ""; $>                        <tr <$= _trClass $> >                        <$ if(GlobalData.isLeftTemplate && GlobalData.isTemplate){ $>                            <td class="grid_template" data-col="grid_template" align="center">                                <div style="text-align:center;width:<$= GlobalData.templateWidth $>px;">                                    <$ for(var j = 0,jl = GlobalData.templateModule.length;j < jl;j++){                                        var temp = GlobalData.templateModule[j],                                            tempClass = true === temp.isDisable ? " disable" : "";                                            if($.type(temp.convert) === "function" && temp.convert.call(null,item) == false){ $>                                                <a href="javascript:" data-template class="<$= temp.convertClassName + " disable" $>"><i class="<$= temp.iClass $>"></i><$= temp.title $></a>                                            <$ }else{ $>                                                <a href="javascript:" data-template class="<$= temp.className + tempClass $>"><i class="<$= temp.iClass $>"></i><$= temp.title $></a>                                            <$ } $>                                    <$ } $>                                </div>                            </td>                        <$ } $>                        <$ if(GlobalData.isNumber){ $>                            <td data-col="grid_number" align="center">                                <div style="text-align: center;width:30px;"><$= i+1 $></div>                            </td>                        <$ } $>                        <$ if(GlobalData.isCheckBox){ $>                            <td data-col="grid_check" align="center">                                <div style="text-align: center;width:40px;">                                    <input type="checkbox" />                                </div>                            </td>                        <$ } $>                        <$ for(var j = 0,jl = GlobalData.colModule.length;j < jl;j++){                            var col = GlobalData.colModule[j],                                _class = 0 == col.className.length ? "" : "class=" + col.className ; $>                            <td align="<$= col.align $>" <$= _class $> data-name="<$= col.name $>" >                                <div style="text-align:<$= col.align $>;width:<$= col.width $>px">                                <$ if(col.isDetail){ $>                                    <a href="javascript:" class="icon_up">+</a>                                <$ } $>                                <$ if(col.type == "Label"){ $>                                    <$= col.formatter == null ? item[col.name] : col.formatter(item[col.name]) $>                                <$ }else if(col.type == "Text"){ $>                                    <input type="text" class="text" value="<$= col.formatter == null ? item[col.name] : col.formatter(item[col.name]) $>" />                                <$ }else if(col.type == "Select"){ $>                                    <select>                                    <$ for(var k = 0,kl = col.bindDataSource.length;k < kl;k++){                                        var _check = item[col.name] == col.bindDataSource[k].value ? "selected=selected" : ""; $>                                        <option value="<$= col.bindDataSource[k].value $>" <$= _check $> ><$= col.bindDataSource[k].key $></option>                                    <$ } $>                                    </select>                                <$ }else if(col.type == "MaskSelect"){ $>                                    <$ if(item[col.name] != null){ $>                                    <input type="text" class="maskText" data-json=<$= $.jsonToString(item[col.name]) $> value="<$= item[col.name][col.maskName] $>" />                                    <$ }else { $>                                    <input type="text" class="maskText" />                                    <$ } $>                                    <a href="javascript:" class="maskBtn">…</a>                                <$ } $>                                </div>                            </td>                        <$ } $>                        <$ if(!GlobalData.isLeftTemplate && GlobalData.isTemplate){ $>                            <td class="grid_template" data-col="grid_template" align="center">                                <div style="text-align:center;width:<$= GlobalData.templateWidth $>px;">                                    <$ for(var j = 0,jl = GlobalData.templateModule.length;j < jl;j++){                                        var temp = GlobalData.templateModule[j],                                            tempClass = true === temp.isDisable ? " disable" : "";                                            if($.type(temp.convert) === "function" && temp.convert.call(null,item) == false){ $>                                                <a href="javascript:" data-template class="<$= temp.convertClassName + " disable" $>"><i class="<$= temp.iClass $>"></i><$= temp.title $></a>                                            <$ }else{ $>                                                <a href="javascript:" data-template class="<$= temp.className + tempClass $>"><i class="<$= temp.iClass $>"></i><$= temp.title $></a>                                            <$ } $>                                    <$ } $>                                </div>                            </td>                        <$ } $>                        </tr>                        <tr class="detial none">                            <td colspan="<$= GlobalData.detail.colspan $>"><div style="width:auto"></div></td>                        </tr>                    <$ } $>                </table>',rowTempalte:'                <tr <$= GlobalData.trClass $> >                    <$ if(GlobalData.isLeftTemplate && GlobalData.isTemplate){ $>                        <td class="grid_template" data-col="grid_template" align="center">                            <div style="text-align:center;width:90px;">                                <a href="javascript:" data-type="delete" class="graybtn"><i class="icon-trash"></i>删除</a>                            </div>                        </td>                    <$ } $>                    <$ if(GlobalData.isCheckBox){ $>                        <td data-col="grid_check" align="center">                            <div style="text-align: center;width:40px;">                                <input type="checkbox" />                            </div>                        </td>                    <$ } $>                    <$ if(GlobalData.data){                        var item = GlobalData.data; $>                    <$ for(var j = 0,jl = GlobalData.colModule.length;j < jl;j++){                        var col = GlobalData.colModule[j],                            _class = 0 == col.className.length ? "" : "class=" + col.className ;                        if(GlobalData.rowAddModule.indexOf("," + col.name + ",") !== -1){ $>                            <td align="<$= col.align $>" <$= _class $> data-name="<$= col.name $>" >                                <div style="text-align:<$= col.align $>;width:<$= col.width $>px">                                <$ if(col.isDetail){ $>                                    <a href="javascript:" class="icon_up">+</a>                                <$ } $>                                <$ if(col.type == "Label"){ $>                                    <$= col.formatter == null ? item[col.name] : col.formatter(item[col.name]) $>                                <$ }else if(col.type == "Text"){ $>                                    <input type="text" class="text" value="<$= col.formatter == null ? item[col.name] : col.formatter(item[col.name]) $>" />                                <$ }else if(col.type == "Select"){ $>                                    <select>                                    <$ for(var k = 0,kl = col.bindDataSource.length;k < kl;k++){                                        var _check = item[col.name] == col.bindDataSource[k].value ? "selected=selected" : ""; $>                                        <option value="<$= col.bindDataSource[k].value $>" <$= _check $> ><$= col.bindDataSource[k].key $></option>                                    <$ } $>                                    </select>                                <$ }else if(col.type == "MaskSelect"){ $>                                    <$ if(item[col.name] != null){ $>                                    <input type="text" class="maskText" data-json=<$= $.jsonToString(item[col.name]) $> value="<$= item[col.name][col.maskName] $>" />                                    <$ }else { $>                                    <input type="text" class="maskText" />                                    <$ } $>                                    <a href="javascript:" class="maskBtn">…</a>                                <$ } $>                                </div>                            </td>                        <$ }else{ $>                            <td><div style="text-align:<$= col.align $>;width:<$= col.width $>px"></div></td>                        <$ } $>                    <$ } $>                    <$ }else{ $>                    <$ for(var j = 0,jl = GlobalData.colModule.length;j < jl;j++){                        var col = GlobalData.colModule[j],                            _class = 0 == col.className.length ? "" : "class=" + col.class ;                        if(GlobalData.rowAddModule.indexOf("," + col.name + ",") !== -1){ $>                            <td align="<$= col.align $>" <$= _class $> data-name="<$= col.name $>" >                                <div style="text-align:<$= col.align $>;width:<$= col.width $>px">                                <$ if(col.type == "Text"){ $>                                    <input type="text" class="text" value="" />                                <$ }else if(col.type == "Select"){ $>                                    <select>                                    <$ for(var k = 0,kl = col.bindDataSource.length;k < kl;k++){ $>                                        <option value="<$= col.bindDataSource[k].value $>" ><$= col.bindDataSource[k].key $></option>                                    <$ } $>                                    </select>                                <$ }else if(col.type == "MaskSelect"){ $>                                    <input type="text" class="maskText" />                                    <a href="javascript:" class="maskBtn">…</a>                                <$ } $>                                </div>                            </td>                        <$ }else{ $>                            <td><div style="text-align:<$= col.align $>;width:<$= col.width $>px"></div></td>                        <$ } $>                    <$ } $>                    <$ } $>                    <$ if(!GlobalData.isLeftTemplate && GlobalData.isTemplate){ $>                        <td class="grid_template" data-col="grid_template" align="center">                            <div style="text-align:center;width:90px;">                                <a href="javascript:" data-type="delete" class="graybtn"><i class="icon-trash"></i>删除</a>                            </div>                        </td>                    <$ } $>                </tr>'},H);this.setOptions();this.bindEvent();},setOptions:function(){this.panel.css("height",this.height+"px");this.loadPage(this.data);},bindEvent:function(){},loadPage:function(M){this.selectRow=null;this.data=M||this.data;this.panel.html(A.template.replace(this.template,{data:this.data,colModule:this.colModule,templateWidth:this.templateWidth,isTemplate:this.isTemplate,isLeftTemplate:this.isLeftTemplate,templateModule:this.templateModule,isCheckBox:this.isCheckBox,isNumber:this.isNumber,detail:this.getDetail()}));var H=this,J=this.panel.find("tr");this.rowList=[];for(var I=0,L=this.data.length;I<L;I++){var K=new G.RowControl({panel:A(J[I*2]),detialPanel:A(J[I*2+1]),data:this.data[I],colModule:this.colModule,isTemplate:this.isTemplate,isLeftTemplate:this.isLeftTemplate,otherColNumber:this.otherColNumber,templateModule:this.templateModule,isCheckBox:this.isCheckBox,isNumber:this.isNumber,onDetail:this.onDetail,onDoubleClick:this.onDoubleClick,onClick:this.onClick});K.addEvent("onChange",function(N){H.setSelectRow(this.panel);});this.rowList.push(K);}},getDetail:function(){var I=0,J=0;J+=this.isNumber==true?1:0;I+=this.isCheckBox==true?40:0;J+=this.isCheckBox==true?1:0;I+=this.isTemplate==true?160:0;J+=this.isTemplate==true?1:0;for(var H=this.colModule.length-1;H>=0;H--){I+=this.colModule[H].width;J++;}return{width:I,colspan:J};},checkAll:function(I){for(var H=this.rowList.length-1;H>=0;H--){this.rowList[H].check(I);}},getSelectedData:function(){var H=[];for(var I=0,J=this.rowList.length;I<J;I++){if(this.rowList[I].checkBtn[0].checked){H.push(this.rowList[I].data);}}return H;},addRow:function(I){var L=this,J=this.rowList.length,K=A(A.template.replace(this.rowTempalte,{trClass:J%2==0?"class=two":"",colModule:this.colModule,rowAddModule:this.rowAddModule,isTemplate:this.isTemplate,isLeftTemplate:this.isLeftTemplate,templateModule:this.templateModule,isCheckBox:this.isCheckBox,data:I||{}}));if(this.selectRow){K.insertAfter(this.selectRow);}else{this.panel.find("table").append(K);}var H=new G.RowControl({panel:K,colModule:this.colModule,rowAddModule:this.rowAddModule,isTemplate:this.isTemplate,isLeftTemplate:this.isLeftTemplate,otherColNumber:this.otherColNumber,templateModule:this.templateModule,isCheckBox:this.isCheckBox,isNumber:this.isNumber,data:I||{},type:"add"});H.addEvent("onChange",function(){L.setSelectRow(this.panel);});H.addEvent("addDetele",function(){if(L.selectRow==this.panel){L.selectRow=null;}this.panel.remove();this.isDeleteRow=true;L.deleteRow();});this.rowList.push(H);return K;},getData:function(){var H=[];for(var I=0,J=this.rowList.length;I<J;I++){H.push(this.rowList[I].getData());}return H;},getUpdateData:function(){var I=[];for(var J=0,K=this.rowList.length;J<K;J++){var H=this.rowList[J].getUpdateData();if(H){I.push(H);}}return I;},getDataByType:function(H){var I=[];for(var J=0,K=this.rowList.length;J<K;J++){if(this.rowList[J].type==H){I.push(this.rowList[J].getData());}}return I;},setColWidth:function(H,I){var J=this;this.panel.find(">table>tbody>tr:not(.detial)").each(function(K,L){A(L).find("td:eq("+(J.otherColNumber+H)+")>div").css("width",J.colModule[H].width+"px");});},setSort:function(H,J){this.data=this.getData();if(this.data.length>0){var I=isNaN(this.data[0][H]*1);if(J=="desc"){if(I){this.sortData(H,true);}else{this.data.sort(function(L,K){return K[H]-L[H];});}}else{if(I){this.sortData(H,false);}else{this.data.sort(function(L,K){return L[H]-K[H];});}}}this.loadPage();},sortData:function(I,H){if(H){this.data.sort(function(K,J){return K[I]==J[I]?0:K[I]>J[I]?1:-1;});}else{this.data.sort(function(K,J){return K[I]==J[I]?0:K[I]<J[I]?1:-1;});}},setSelectRow:function(H){if(this.selectRow){this.selectRow.removeClass("selected");}this.selectRow=H;this.selectRow.addClass("selected");},selectedRows:function(I,H){var L=[];A.extend(L,I,true);for(var J=0,K=this.rowList.length;J<K;J++){if(L.length==0){return;}if(this.rowList[J].data[H]===L[0][H]){this.rowList[J].checkBtn[0].checked=true;L.shift();}}},setSelectCell:function(H){},deleteRow:function(){for(var H=this.rowList.length-1;H>=0;H--){if(this.rowList[H].isDeleteRow){this.rowList.splice(H,1);return;}}},selectRowByName:function(I,H,J){for(var K=0,L=this.rowList.length;K<L;K++){if(J){if(this.rowList[K].data[H].indexOf(I[H])!==-1){this.rowList[K].panel.trigger("click.gridView");return;}}else{if(this.rowList[K].data[H]==I[H]){this.rowList[K].panel.trigger("click.gridView");return;}}}}});G.RowControl=A.Base.Event.extend({init:function(H){A.extend(this,{panel:null,detialPanel:null,detialBtn:null,data:null,cellList:{},checkBtn:null,updateBtn:null,deleteBtn:null,rowAddModule:null,templateState:[],type:"load"},H);this.setOptions();this.bindEvent();},setOptions:function(){this.oldData=A.extend(true,{},this.data);this.detialBtn=this.panel.find("a.icon_up");if(this.isCheckBox){this.checkBtn=this.panel.find("td:eq("+((false==this.isNumber?0:1)+(false==this.isLeftTemplate?0:1))+") input");}if(this.isTemplate){this.templateBtns=this.panel.find(".grid_template a");}this.initCells();this.initTemplate();if(this.rowAddModule){this.newEvent("addDetele","memory");}this.newEvent("onChange","memory");},bindEvent:function(){var I=this;if(this.onDoubleClick){this.panel.on("dblclick.gridView",function(){if(A.type(I.onDoubleClick)==="function"){I.onDoubleClick.call(null,I.data);}});}this.panel.on("click.gridView",function(){I.triggerEvent("onChange");if(I.onClick){A.type(I.onClick)==="function"&&I.onClick.call(I,I.data);}});if(I.rowAddModule){I.templateBtns.on("click.gridView",function(){I.triggerEvent("addDetele");return;});}else{for(var H=0,J=this.templateModule.length;H<J;H++){if(this.templateModule[H].isDisable){continue;}if(this.templateState[H].flag){(function(K){I.templateBtns.eq(K).on("click.gridView",function(){if(A.type(I.templateModule[K].onChange)==="function"){I.templateModule[K].onChange.call(null,I.data);}});})(H);}}}this.detialBtn.on("click.gridView",function(){if(I.detialBtn.data("type")===undefined){if(A.type(I.onDetail)==="function"){I.onDetail.call(null,I.data,I.detialPanel.find("div"));I.detialBtn.html("-").removeClass("icon_up").addClass("icon_down").data("type",true);I.detialPanel.show();}}else{if(I.detialBtn.data("type")){I.detialBtn.html("+").removeClass("icon_down").addClass("icon_up").data("type",false);I.detialPanel.hide();}else{I.detialBtn.html("-").removeClass("icon_up").addClass("icon_down").data("type",true);I.detialPanel.show();}}});},initCells:function(){var K=this;for(var J=0,L=this.colModule.length;J<L;J++){var H=this.colModule[J];if(H.type!="Label"){var I=new G.CellControl({data:this.data,rowPanel:this.panel,panel:this.panel.find("td:eq("+(J+this.otherColNumber)+")"),colModule:H});this.cellList[H.name]=I;if(H.init&&A.type(H.init)=="function"){H.init.call(null,I.btn,I.maskBtn);}}}},initTemplate:function(){var I=0;for(var J=0,L=this.templateModule.length;J<L;J++){var K=this.templateModule[J].convert;if(K&&A.type(K)==="function"){var H=K.call(null,this.data);this.templateState.push({flag:H,btnIndex:false==H?--I:I});}else{this.templateState.push({flag:true,btnIndex:I});}I++;}},check:function(H){if(this.checkBtn){this.checkBtn[0].checked=H;}},getData:function(){var H=this.data||{};for(var I in this.cellList){H[I]=this.cellList[I].getValue();}return H;},getUpdateData:function(){var J=this,K=false,I=this.data||{};for(var H in this.cellList){I[H]=this.cellList[H].getValue();for(var M=J.colModule.length-1;M>=0;M--){if(J.colModule[M].name==H){if(J.colModule[M].type=="MaskSelect"){var L=J.colModule[M].maskName;if(J.oldData[H][L]!=I[H][L]){K=true;}}else{if(J.oldData[H]!=I[H]){K=true;}}}}}return false==K?null:I;}});G.CellControl=A.Base.Event.extend({init:function(H){A.extend(this,{data:null,rowPanel:null,panel:null,btn:null,maskBtn:null,colModule:null},H);this.setOptions();this.bindEvent();},setOptions:function(){if(this.colModule.type=="Text"){this.btn=this.panel.find("input");}else{if(this.colModule.type=="Select"){this.btn=this.panel.find("select");}else{if(this.colModule.type=="MaskSelect"){this.btn=this.panel.find("input");this.maskBtn=this.panel.find("a.maskBtn");}else{this.btn=this.panel.find("div");}}}},bindEvent:function(){var J=this;if((this.colModule.type=="Text"||this.colModule.type=="Select")&&this.colModule.triggerList.length>0){for(var H=0,K=this.colModule.triggerList.length;H<K;H++){var I=this.colModule.triggerList[H];if(I.triggerType){(function(L){J.btn.on(L.triggerType,function(M){if(A.type(L.triggerChange)==="function"){L.triggerChange.call(J,J.data,J.btn,J.rowPanel,M);}});})(I);}}}else{if(this.colModule.type=="MaskSelect"&&this.colModule.onMask){this.maskBtn.on("click.gridView",function(L){if(A.type(J.colModule.onMask)==="function"){J.colModule.onMask.call(J,J.data,J.btn,J.rowPanel,L);}});}}},getValue:function(){if(this.colModule.type=="Text"||this.colModule.type=="Select"){return this.btn.val();}else{if(this.colModule.type=="MaskSelect"){return this.btn.data("json");}}},setValue:function(H){if(this.colModule.type=="Text"||this.colModule.type=="Select"){this.btn.val(H);}else{if(this.colModule.type=="Label"){this.btn.html(H);}else{if(this.colModule.type=="MaskSelect"){this.btn.val(H[this.colModule.maskName]);this.btn.data("json",H);}}}}});var C=function(H,I){this.opts={datasource:[],width:null,height:500,headAlign:"center",pageModule:{panel:null,isTop:false,index:1,pageNum:50,pageRate:[50,100,200,500],total:50,onChange:null,onSetNum:null,type:true},colHead:[],colModule:[],rowAddModule:"",isLeftTemplate:false,templateModule:[],sortModule:{global:false,onChange:null},isSort:true,isNumber:true,isDrag:true,otherItems:[],isCheckBox:false,colOrderKey:"",onWhere:null,onDetail:null,onClick:null,onDoubleClick:null};A.extend(true,this.opts,I);if(this.opts.pageModule){this.opts.pageModule.pageRate=I.pageModule.pageRate;}this.target=A(H);this.init();this.initialize();};C.prototype={init:function(){this.target.html("");},initialize:function(){this.setOptions();this.bindEvent();},setOptions:function(){A.extend(this,{_colHeadPanel:A('<div class="grid_colHead"></div>'),_dragPanel:A('<div class="grid_drag"></div>'),_tablePanel:A('<div class="grid_table"></div>'),_pagePanel:A('<div class="grid_page"></div>'),_sortName:null,_sortOrder:null,colHead:null,drag:null,table:null,page:null});if(this.opts.width==null){this.target.css("width",this.target.parent().width());B.push(this.target);}this.target.addClass("gridview").append(this._colHeadPanel).append(this._dragPanel).append(this._tablePanel);this.formatTempalteModule();this.formatColModule();this.colHead=new G.ColHeadControl({panel:this._colHeadPanel,colHead:this.opts.colHead,colModule:this.opts.colModule,templateWidth:this.templateWidth,isTemplate:this.isTemplate,isCheckBox:this.opts.isCheckBox,isSort:this.opts.isSort,isNumber:this.opts.isNumber,isLeftTemplate:this.opts.isLeftTemplate,otherColNumber:this.otherColNumber});if(this.opts.isDrag){this.drag=new G.DragControl({panel:this._dragPanel,colModule:this.opts.colModule,height:this.opts.height+this._colHeadPanel.height(),templateWidth:this.templateWidth,isTemplate:this.isTemplate,isCheckBox:this.opts.isCheckBox,isNumber:this.opts.isNumber,isLeftTemplate:this.opts.isLeftTemplate,otherColNumber:this.otherColNumber});}this.table=new G.TableControl({panel:this._tablePanel,colModule:this.opts.colModule,rowAddModule:this.opts.rowAddModule,data:this.opts.datasource,height:this.opts.height,templateModule:this.opts.templateModule,templateWidth:this.templateWidth,isTemplate:this.isTemplate,isCheckBox:this.opts.isCheckBox,isNumber:this.opts.isNumber,isLeftTemplate:this.opts.isLeftTemplate,otherColNumber:this.otherColNumber,onDetail:this.opts.onDetail,onDoubleClick:this.opts.onDoubleClick,onClick:this.opts.onClick});if(this.opts.pageModule){if(this.opts.pageModule.panel!=null&&this.opts.pageModule.panel.length>0){this.opts.pageModule.panel.append(this._pagePanel);}else{if(this.opts.pageModule.isTop){this._pagePanel.insertBefore(this._colHeadPanel);}else{this.target.append(this._pagePanel);}}this.page=this._pagePanel.GridPage({total:this.opts.pageModule.total,index:this.opts.pageModule.index,pageNum:this.opts.pageModule.pageNum,pageRate:this.opts.pageModule.pageRate,onChange:this.opts.pageModule.onChange,onSetNum:this.opts.pageModule.onSetNum,type:this.opts.pageModule.type});}this.setWidth();},bindEvent:function(){var H=this;this.table.panel.scroll(function(){H.opts.isDrag&&H.drag.setScrollLeft(H.table.panel.scrollLeft());H.colHead.panel.scrollLeft(H.table.panel.scrollLeft());});this.colHead.addEvent("whereChange",function(I){if(H.opts.onWhere&&A.type(H.opts.onWhere)==="function"){H.opts.onWhere.call(null,I);}});this.colHead.addEvent("sortChange",function(I){H.sortName=I.sortName;H.sortOrder=I.sortOrder;if(H.opts.sortModule.global&&A.type(H.opts.sortModule.onChange)==="function"){H.opts.sortModule.onChange.call(H,H.sortName,H.sortOrder);}else{H.table.setSort(H.sortName,H.sortOrder);}});this.colHead.addEvent("checkAll",function(I){H.table.checkAll(I);});if(this.opts.isDrag){this.drag.addEvent("dragCol",function(I){H.colHead.setColWidth(I.index);H.table.setColWidth(I.index);});}},formatTempalteModule:function(){if(this.opts.templateModule.length>0){this.templateWidth=(this.opts.templateModule.length*90);}else{if(this.opts.rowAddModule.length>0){this.templateWidth=90;}}this.isTemplate=this.opts.templateModule.length>0||this.opts.rowAddModule.length>0;this.otherColNumber=(true==this.isTemplate&&true==this.opts.isLeftTemplate?1:0)+(false==this.opts.isNumber?0:1)+(false==this.opts.isCheckBox?0:1);},formatColModule:function(){var I=[];for(var J=0,K=this.opts.colModule.length;J<K;J++){var H=A.extend(true,{width:100,headAlign:this.opts.headAlign,align:"center",type:"Label",className:"",formatter:null,triggerList:[],init:null,isSort:!this.opts.sortModule.global},this.opts.colModule[J]);I.push(H);}this.opts.colModule=I;this.opts.rowAddModule=","+this.opts.rowAddModule+",";},setWidth:function(){if(this.opts.width){this.target.css("width",this.opts.width+"px");}},GetData:function(){return this.table.getData();},GetUpdateData:function(){return this.table.getUpdateData();},GetAddData:function(){return this.table.getDataByType("add");},GetSelectedData:function(){return this.table.getSelectedData();},LoadPage:function(H){this.table.loadPage(H);if(this.opts.isCheckBox){this.colHead.checkBtn[0].checked=false;}if(!this.opts.sortModule.global){if(this.colHead.prevSort){this.colHead.prevSort.removeSort();}}},AddRow:function(H){return this.table.addRow(H);},SetPageIndex:function(H){this.page.index=H;},SetTotle:function(H){this.page.setTotle(H);},SelectedRows:function(H,I){if(this.opts.isCheckBox&&H.length>0){this.table.selectedRows(H,I);}},SelectRow:function(I,H,J){this.table.selectRowByName(I,H,J);},AppendRow:function(H){this.appendRow().find("td").append(H);},AppendToRow:function(H){this.appendRow().find("td").appendTo(H);},appendRow:function(){var H=this.opts.colModule.length,I=H+(this.opts.isNumber==false?0:1)+(this.opts.isCheckBox==false?0:1)+(this.opts.templateModule.length>0?1:0);_rowDom=A("<tr><td colspan="+I+"></td></tr>");this.table.panel.find("table").append(_rowDom);return _rowDom;}};A.fn.extend({GridView:function(H){var I={};if(typeof H!=="undefined"){A.extend(true,I,H);}C["instance"]=new C(this,I);return C["instance"];}});})(jQuery);