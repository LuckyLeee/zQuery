(function(B,C){var D=null;var A=function(){var H=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,F=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,G=/[^-+\dA-Z]/g,I=function(K,J){K=String(K);J=J||2;while(K.length<J){K="0"+K;}return K;};return function(U,V,W){var Y=A;if(arguments.length==1&&Object.prototype.toString.call(U)=="[object String]"&&!/\d/.test(U)){V=U;U=C;}U=U?new Date(U):new Date;V=String(Y.masks[V]||V||Y.masks["default"]);if(V.slice(0,4)=="UTC:"){V=V.slice(4);W=true;}var T=W?"getUTC":"get",N=U[T+"Date"](),O=U[T+"Day"](),Z=U[T+"Month"](),P=U[T+"FullYear"](),R=U[T+"Hours"](),K=U[T+"Minutes"](),S=U[T+"Seconds"](),J=U[T+"Milliseconds"](),X=W?0:U.getTimezoneOffset(),Q={d:N,dd:I(N),ddd:Y.i18n.dayNames[O],dddd:Y.i18n.dayNames[O+7],m:Z+1,mm:I(Z+1),mmm:Y.i18n.monthNames[Z],mmmm:Y.i18n.monthNames[Z+12],yy:String(P).slice(2),yyyy:P,h:R%12||12,hh:I(R%12||12),H:R,HH:I(R),M:K,MM:I(K),s:S,ss:I(S),l:I(J,3),L:I(J>99?Math.round(J/10):J),t:R<12?"a":"p",tt:R<12?"am":"pm",T:R<12?"A":"P",TT:R<12?"AM":"PM",Z:W?"UTC":(String(U).match(F)||[""]).pop().replace(G,""),o:(X>0?"-":"+")+I(Math.floor(Math.abs(X)/60)*100+Math.abs(X)%60,4),S:["th","st","nd","rd"][N%10>3?0:(N%100-N%10!=10)*N%10]};return V.replace(H,function(L){return L in Q?Q[L]:L.slice(1,L.length-1);});};}();A.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};A.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(G,F){return A(this,G,F);};String.prototype.toInt=function(){return ~~this;};String.prototype.isMonth=function(){var I=this.match(/^(\d{4})-(\d{1,2})$/);if(I){var G=I[1].toInt(),F=I[2].toInt()-1,H=1,J=new Date(G,F,H);if(J.getFullYear()==G&&_data.getMonth()==F){return true;}}return false;};String.prototype.isDate=function(){var I=this.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(I){var G=I[1].toInt(),H=I[2].toInt()-1,I=I[3].toInt(),F=new Date(G,H,I);if(F.getFullYear()==G&&F.getMonth()==H&&F.getDate()==I){return true;}}return false;};String.prototype.toDate=function(){var I=this.match(/^(\d{4})-(\d{1,2})-(\d{1,2})( \d{1,2}:\d{1,2}:\d{1,2}(\.\d+)?)?$/);if(I){var G=I[1].toInt(),H=I[2].toInt()-1,I=I[3].toInt(),F=new Date(G,H,I);if(F.getFullYear()==G&&F.getMonth()==H&&F.getDate()==I){return F;}}return null;};String.prototype.replaceWith=function(F){return this.replace(/\{\$(\w+)\}/g,function(H,G){if(G in F){return F[G];}else{return H;}});};String.prototype.pad=function(){var J=0,I=0,M=0,G="",F=this.split("-");var K=parseInt(F[0],10),L=parseInt(F[1],10),H=parseInt(F[2],10);J=(K>200)?K:1900+K;I=(L>=10)?L:"0"+L;M=(H>=10)?H:"0"+H;G=J+"-"+I+"-"+M;return G;};if(!Array.prototype.forEach){Array.prototype.forEach=function(H,F){var G=this.length;if(typeof H!="function"){throw new TypeError();}var F=arguments[1];for(var I=0;I<G;I++){if(I in this){H.call(F,this[I],I,this);}}};}if(!Function.prototype.bind){Function.prototype.bind=function(F){if(typeof this!=="function"){B.error("Function.prototype.bind - what is trying to be bound is not callable");}var H=Array.prototype.slice.call(arguments,1),I=this,J=function(){},G=function(){return I.apply(this instanceof J&&F?this:F||window,H.concat(Array.prototype.slice.call(arguments)));};J.prototype=this.prototype;G.prototype=new J();return G;};}var E=function(F,G){this.opts={date:new Date(),type:"week",minDate:null,maxDate:null,startDate:null,endDate:null,template:{head:'<div class="calendar_title"><button class="{$type}"></button>{$data}</div>',shead:'<div class="calendar_title"><button class="{$typel}"></button>{$data}<button class="{$typer}"></button></div>',body:'<dl class="calendar_day"><dt class="week">周</dt><dt>一</dt><dt>二</dt><dt>三</dt><dt>四</dt><dt>五</dt><dt class="weekend">六</dt><dt class="weekend">日</dt><dd>{$dates}</dd></dl>',bodyMonth:'<dl class="calendar_month"><dd>{$dates}</dd></dl>',foot:"",week:'<a href="javascript:" {$id} {$Class} {$Style}>{$week}</a>',day:'<a href="javascript:" {$id} {$Class} {$Style}>{$day}</a>',month:'<a href="javascript:" {$id} {$Class} {$Style}>{$month}</a>',festival:'<span class="c_day_festival">{$day}</span>'},classNames:{select:"select",nothismonth:"day_over",blankdate:"day_no",today:"today",tomorrow:"",aftertomorrow:"",none:"none",type:"left"},tagName:{prevOrNextBtn:"button",month:"a",day:"a",week:"a"},typeList:{"calendar_prev":-1,"calendar_next":1},listeners:{onBeforeShow:null,onShow:null,onChange:null},container:null};B.extend(true,this.opts,G);B.extend(this,this.opts);this.target=B(F);this.init();this.initialize();};E.prototype={init:function(){this.createEl();},initialize:function(){this.setOptions();this.bindEvent();},setOptions:function(){},bindEvent:function(){var F=this;this.target.bind("click",function(){F.render(F.formatDate());F.setPosition();});this.target.bind("blur",function(){F.panel.hide();});this.panel.bind("mousedown",function(H){var I=H.target,G=B(I);if(I.tagName==F.tagName.prevOrNextBtn.toUpperCase()){var K=false;for(var J in F.typeList){if(G.hasClass(J)){K=true;break;}}if(K){F.change(F.typeList[I.className]);return false;}}I=(I.tagName==F.tagName.day.toUpperCase()?I:G.parents(F.tagName.day)[0]);if(I){F.clickEvent(I);return false;}return false;});},change:function(G){var F=null;switch(this.type){case"week":this.changeMonth+=G;F=new Date(this.changeYear,this.changeMonth,1);break;case"month":this.changeYear+=G;F=new Date(this.changeYear,this.changeMonth,1);break;case"year":break;}this.render(F);},clickEvent:function(H){if(!B(H).hasClass(this.classNames.nothismonth)){var F=B(H).data("val"),G=B(H).data("date");switch(this.type){case"week":this.target.data(this.type,G).val(F);this.panel.hide();this.target.blur();break;case"month":this.target.data(this.type,G).val(F);this.panel.hide();this.target.blur();break;case"year":break;}if(B.type(this.listeners.onChange)==="function"){this.listeners.onChange.call(null,G,F,H);}}},formatDate:function(){var G=this.target.data(this.type),H=null;if(G){var F=G.split(",");this.startDate=F[0];this.endDate=F[1];H=this.startDate.toDate();this.changeYear=this.yearDate=H.getFullYear();this.changeMonth=this.monthDate=H.getMonth();this.weekDate=this.getWeek(H);}else{this.changeYear=this.yearDate=this.date.getFullYear();this.changeMonth=this.monthDate=this.date.getMonth();}return H||this.date;},createEl:function(){this.panel=B('<div class="otherCalendar"></div>');this.panel.appendTo(this.container||$$.container);},render:function(F){this.panel.html("");this.panel.append(this.createHead(F));this.panel.append(this.createBody(F));this.panel.show();},setPosition:function(){var F=this.target.offset();F.top+=this.target[0].offsetHeight;this.panel.offset(F);this.panel.cover();B.type(this.listeners.onShow)==="function"&&this.listeners.onShow.call(this);},createHead:function(F){switch(this.type){case"week":return this.template.shead.replaceWith({typel:"calendar_prev",typer:"calendar_next",data:F.getFullYear()+"年"+(F.getMonth()+1)+"月"});break;case"month":return this.template.shead.replaceWith({typel:"calendar_prev",typer:"calendar_next",data:F.getFullYear()+"年"});break;case"year":break;}},createBody:function(P){var T=P.getFullYear(),I=P.getMonth(),F=null,Q=null,O="",R=null,M=null;switch(this.type){case"week":var J=new Date(T,I,1).getDay()-1,L=new Date(T,I+1,0).getDate()+1,N=[];for(var S=1;S<43;S++){var H=new Date(T,I,(S-J)),U=this.getClass(H);if(S%7==1){R=this.getWeek(H);O=this.weekDate!=null?(this.weekDate.week==R.week?this.classNames.select:""):"";M=['data-date="',R.date.join(","),'" data-val="',R.year,"年第",R.week,'周"'].join("");N.push(this.template.week.replaceWith({id:M,Class:['class="week ',O," ",U,'"'].join(""),Style:"",week:R.week}));}if(S>J&&S<L+J){N.push(this.template.day.replaceWith({id:M,Class:['class="',O," ",U,'"'].join(""),Style:"",day:S-J}));}else{if(S>L){N.push(this.template.day.replaceWith({id:"",Class:['class="',this.classNames.nothismonth,'"'].join(""),Style:"",day:""}));}else{N.push(this.template.day.replaceWith({id:"",Class:['class="',this.classNames.nothismonth,'"'].join(""),Style:"",day:""}));}}}return this.template.body.replaceWith({dates:N.join("")});break;case"month":var N=[];for(var S=0;S<12;S++){var U=this.getClass(new Date(T,S,1));var G=(this.yearDate==T&&this.monthDate==S)?this.classNames.select:"";var K=this.template.month.replaceWith({id:['data-date="',new Date(T,S,1).format("yyyy-mm-dd"),'"','data-val="',T,"年",S+1,'月"'].join(""),Class:['class="',G," ",U,'"'].join(""),Style:"",month:(S+1)+"月"});N.push(K);}return this.template.bodyMonth.replaceWith({dates:N.join("")});break;case"year":break;}},getWeek:function(P){if(P){var I=P.format("yyyy-mm-dd").toDate();var M=[],G=0,J=I.getFullYear(),N=new Date(J,0,1),K=N.getDay(),L=(I.getTime()-N.getTime())/1000/60/60/24,H=~~((L+K-1)/7)+1;G=H>52?1:H;J=H>52?J+1:J;M.push(I.format("yyyy-mm-dd"));I.setDate(I.getDate()+6);var O=I,F=this.maxDate!=null?this.strToDate(this.maxDate.pad()):null;if(F&&O.getTime()>F.getTime()){M.push(this.maxDate);}else{M.push(O.format("yyyy-mm-dd"));}return{week:G,year:J,date:M};}},getClass:function(G){var H="",F=this.minDate,I=this.maxDate;if(F){F=F.pad();}if(I){I=I.pad();}if(F&&this.strToDate(G.format("yyyy-mm-dd"))<this.strToDate(F)){H=this.classNames.nothismonth;}if(I&&this.strToDate(G.format("yyyy-mm-dd"))>this.strToDate(I)){H=this.classNames.nothismonth;}return H;},strToDate:function(F){if(F){return F.toDate();}}};B.fn.extend({OtherCalendar:function(F){var G={};if(typeof F!=="undefined"){B.extend(true,G,F);}E["instance"]=new E(this,G);return E["instance"];}});})(jQuery,undefined);